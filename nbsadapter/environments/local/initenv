#!/bin/ksh

echo "Setting up kafka topics"
/opt/homebrew/opt/kafka/bin/kafka-topics --create --bootstrap-server localhost:29092 --replication-factor 1 --partitions 1 --topic hl7-msgs-topic
/opt/homebrew/opt/kafka/bin/kafka-topics --create --bootstrap-server localhost:29092 --replication-factor 1 --partitions 1 --topic xml-msgs-topic

echo "Setting up vault"
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=nj101
export VAULT_ADDR VAULT_TOKEN

/opt/homebrew/opt/vault/bin/vault secrets enable -version=1 -path kv kv
/opt/homebrew/opt/vault/bin/vault secrets enable -version=1 -path secrets kv

curl $VAULT_ADDR/v1/secrets/nbsadapter/local -d @nbsadapter.local.json -H "X-Vault-Token: nj101" -X POST
curl $VAULT_ADDR/v1/secrets/nbsadapter/local -H "X-Vault-Token: nj101" -X GET

if [ ! -d "/tmp/hl7files" ] 
then
    mkdir /tmp/hl7files
    echo "Created directory /tmp/hl7files"
fi

